<div class="p-4">
  <header class="mb-4">
    <p class="font-semibold">
      {{ref?.data ? 'Update Bookmark':'Create New Bookmark'}}
    </p>
  </header>
  <form class="w-100">
    <div class="form-group">
      <label for="url">Bookmark URL</label>
      <input type="url" name="url" id="url" autocomplete="off" [formControl]="bookmarkFormControls.url" #bookmarkURLRef
             [disabled]="(isLoading$ | async)">
      <p class="absolute bottom-0 text-xs text-red-500"
         *ngIf="bookmarkFormControls.url.touched && bookmarkFormControls.url.errors ">
        Please enter a valid URL</p>
    </div>
    <section *ngIf="(metaData$ | async) as meta">
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" name="name" id="name" autocomplete="off" [formControl]="bookmarkFormControls.name"
               [disabled]="isLoading$ | async">
      </div>
      <div class="form-group">
        <label for="description">Description</label>
        <textarea name="description" id="description" rows="4"
                  [formControl]="bookmarkFormControls.description"></textarea>
      </div>
      <div class="w-1/2 form-group">
        <label for="site">Site</label>
        <input type="text" name="site" id="site" autocomplete="off" [formControl]="bookmarkFormControls.site">
      </div>
      <app-bookmark-add-preview [meta]="meta" [title]="bookmarkFormControls.name?.value"
                                [description]="bookmarkFormControls.description?.value"></app-bookmark-add-preview>
    </section>
    <section *ngIf="(isLoading$ | async)">
      <h3 class="mb-3 text-sm font-semibold">Preview</h3>
      <div class="flex px-3 py-2 rounded-md shadow-lg" style="height: 170px;">
        <ng-container *ngTemplateOutlet="previewSkeletonLoader"></ng-container>
      </div>
    </section>
  </form>
  <footer class="flex items-center mt-6" [ngClass]="ref?.data?.type === 'CREATE' ? 'justify-between' : 'justify-end'">
    <ng-container *ngIf="ref?.data?.type === 'CREATE'">
      <button class="mr-2 bg-none" (click)="reset()" [disabled]="bookmarkFormControls.url?.value?.length === 0">
        <rmx-icon name="restart-line" class="icon-lg"></rmx-icon>
      </button>
    </ng-container>
    <div class="flex items-center space-x-2">
      <button dialogClose secondaryButton class="mr-2">Cancel</button>
      <button primaryButton [disabled]="bookmarkFormControls.url.invalid || (isLoading$ | async)"
              (click)="fetchOrAdd(meta)">
        <ng-container *ngIf="isLoading$ | async">
          <svg xmlns="http://www.w3.org/2000/svg"
               style="margin:auto;background:0 0; margin-right: 0.3rem;height: 24px;width: 24px;" width="200"
               height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" display="block">
            <circle cx="50" cy="50" r="32" stroke-width="8" stroke="#fff"
                    stroke-dasharray="50.26548245743669 50.26548245743669" fill="none" stroke-linecap="round">
              <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" keyTimes="0;1"
                                values="0 50 50;360 50 50" />
            </circle>
          </svg>
        </ng-container>
        {{(metaData$ | async) ? (ref.data.type === 'CREATE' ? 'Save' : 'Update') : 'Fetch'}}
      </button>

    </div>
  </footer>
</div>




<ng-template #previewSkeletonLoader>
  <svg width="400" height="160" aria-labelledby="loading-aria" preserveAspectRatio="none"
       xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 160" style="width: 100%;height: 100%;">
    <rect width="100%" height="100%" clip-path="url(#clip-path)" fill="url(&quot;#fill&quot;)" />
    <defs>
      <linearGradient id="fill">
        <stop offset=".6" stop-color="#ededed">
          <animate attributeName="offset" values="-2; -2; 1" keyTimes="0; 0.25; 1" dur="2s" repeatCount="indefinite" />
        </stop>
        <stop offset="1.6" stop-color="#ecebeb">
          <animate attributeName="offset" values="-1; -1; 2" keyTimes="0; 0.25; 1" dur="2s" repeatCount="indefinite" />
        </stop>
        <stop offset="2.6" stop-color="#ededed">
          <animate attributeName="offset" values="0; 0; 3" keyTimes="0; 0.25; 1" dur="2s" repeatCount="indefinite" />
        </stop>
      </linearGradient>
      <clipPath id="clip-path">
        <rect x="205" y="9" rx="3" ry="3" width="183" height="21" />
        <rect x="206" y="44" rx="3" ry="3" width="177" height="9" />
        <rect x="11" y="9" rx="3" ry="3" width="178" height="141" />
        <rect x="205" y="61" rx="3" ry="3" width="177" height="9" />
        <rect x="206" y="78" rx="3" ry="3" width="177" height="9" />
        <rect x="204" y="126" rx="3" ry="3" width="183" height="21" />
      </clipPath>
    </defs>
  </svg>
</ng-template>